@model SistemaIndicadoresAmbientales.Entity.ConsumodeAgua


@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div id="Etiqueta">
        <h1 class="H1-Etiqueta">Historico Consumo de Agua</h1>
    </div>
    <div id="Formulario">
        <div class="Formulario">
            @Html.Label("Mes del Consumo:", htmlAttributes: new { @class = "control-label" })
            @{
                <input type="hidden" value="" name="cantidadConsumos" id="cantidadConsumos" />
                <input type="hidden" value="@ViewData["MesAnterior"]" id="MesAnterior" name="MesAnterior" />
            }
            <select name="Mes" id="Mes" class="form-control">
                <option value="01">Enero</option>
                <option value="02">Febrero</option>
                <option value="03">Marzo</option>
                <option value="04">Abril</option>
                <option value="05">Mayo</option>
                <option value="06">Junio</option>
                <option value="07">Julio</option>
                <option value="08">Agosto</option>
                <option value="09">Setiembre</option>
                <option value="10">Octubre</option>
                <option value="11">Noviembre</option>
                <option value="12">Diciembre</option>
            </select>
            <script>
                document.getElementById("Mes").value = document.getElementById("MesAnterior").value;
            </script>

            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        </div>
        <div class="Formulario">
            @Html.Label("Plantas", htmlAttributes: new { @class = "control-label" })
            @Html.DropDownList("plantas", ViewData["plantas"] as SelectList, new { @class = "form-control" })
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        </div>
        <div class="Formulario">
           <label>Desde:</label>
            <input type="number" class="form-control"  id="Anio2" name="AnioComparar" />
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <label>Hasta:</label>
            <input type="number" class="form-control"  id="Anio1" name="AnioComparar" />
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        </div>
        <div class="Formulario">
            <label>Anual:</label><input type="radio" id="tipo" name="tipo" value="Anual" class='my_chkBox' checked="checked" />
            <label>Mensual:</label><input type="radio" id="tipo" name="tipo" value="Mensual" class='my_chkBox' checked="checked" />
        </div>
        <br />
        <br />
        <table id="Encabezado" class="table">
            <thead id="EncabezaodHead">
            <th>Código:</th><th><input class="form-control" type="text" id="Codigo" name="Codigo" /></th>
            <th>Versión:</th><th><input class="form-control" type="text" id="Version" name="Version" /></th>
            <th>Rige a partir:</th><th><input class="form-control" type="date" id="FechaRegir" name="FechaRegir"/></th>
            </thead>
        </table>
        <div id="pdf" name="pdf">
            <table id="EncabezadoHistoricos" class="table">
                <thead id="EncabezadoBody">
                   
                </thead>
                <tbody id="BodyEncabezado"></tbody>
            </table>
            <table id="Historicos" class="table">
                <thead id="EncabezadoHistoricosBody">
                </thead>
                <tbody id="HistoricosBody">
                </tbody>
            </table>
        </div>
        <div>
            <br />
            <div style="text-align: center;">
                <input value="Exportar" id="Exportar" name="Exportar" onclick="exportarPDF();" type="button" class="from-control">
                <input value="Cargar" id="Cargar" name="Cargar" onclick="cargar();" type="button" class="from-control">

            </div>
        </div>
    </div>
   }
<link href="~/Public/css/DataTable.css" rel="stylesheet" />
<script src="~/Scripts/jquery-1.10.2.min.js" type="text/javascript"></script>
<script src="~/Public/js/jquery-1.9.1.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script type="text/javascript" src="~/Public/PDF/jspdf.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script type="text/javascript">

    function cargar() {
        var PlamNOm = $("plantas").selectedI;
        var mes = document.getElementById("Mes").value;
        var planta = document.getElementById("plantas").value;
        var anio1 = document.getElementById("Anio1").value;
        var anio2 = document.getElementById("Anio2").value;

        var combo = document.getElementById("plantas");
        var selected = combo.options[combo.selectedIndex].text
        var tipo = $('input[name="tipo"]:checked').val();
        if (tipo == "Anual") {
            var datos = { "planta": planta, "anio1": anio1, "anio2": anio2 };

            $.ajax({
                type: 'POST',
                url: '@Url.Action("obtenerHistoricoAguaAnual")',
                dataType: 'json',
                data: datos,

                success: function (consumo) {
                    var json = JSON.stringify(consumo);
                    alert(json);
                    var body = "";
                    var headHistoricosBody = "";
                    var cont = 0;
                    var CantidadTotal = 0;
                    var CantidadMes = 0;
                    var TotalAnio = (anio1-anio2) + 1;
                    headHistoricosBody += "<tr><th>Mes</th>";
                    for (var i = anio2; i <= anio1; i++) {
                        headHistoricosBody += "<th>" + i + "</th>";
                    }//end for
                    headHistoricosBody += "</tr>";
                    var enero = new Array();
                    var febrero = new Array();
                    var marzo = new Array();
                    var abril = new Array();
                    var mayo = new Array();
                    var junio = new Array();
                    var julio = new Array();
                    var agosto = new Array();
                    var setiembre = new Array();
                    var octubre = new Array();
                    var noviembre = new Array();
                    var diciembre = new Array();
                    var Total = new Array();

                    for (var u = 0; u < TotalAnio; u++) {
                        Total.push(0);
                    }
                    for (var i = 0; i < consumo.length; i++) {
                        switch (consumo[i].Mes) {
                            case 1:
                                enero.push(consumo[i].Cantidad);
                                break;
                            case 2:
                                febrero.push(consumo[i].Cantidad);
                                break;
                            case 3:
                                marzo.push(consumo[i].Cantidad);
                                break;
                            case 4:
                                abril.push(consumo[i].Cantidad);
                                break;
                            case 5:
                                mayo.push(consumo[i].Cantidad);
                                break;
                            case 6:
                                junio.push(consumo[i].Cantidad);
                                break;
                            case 7:
                                julio.push(consumo[i].Cantidad);
                                break;
                            case 8:
                                agosto.push(consumo[i].Cantidad);
                                break;
                            case 9:
                                setiembre.push(consumo[i].Cantidad);
                                break;
                            case 10:
                                octubre.push(consumo[i].Cantidad);
                                break;
                            case 11:
                                noviembre.push(consumo[i].Cantidad);
                                break;
                            case 12:
                                diciembre.push(consumo[i].Cantidad);
                                break;
                            default:
                                enero.push(consumo[i].Cantidad);
                                break;
                        }
                    }//end for i
                    for (var j = 1; j <= 12; j++) {

                        switch (j) {
                            case 1:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + enero[cont] + " </td>";
                                    Total[cont] += enero[cont];

                                    cont++;
                                }

                                body += "</tr>";
                                break;
                            case 2:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + febrero[cont] + " </td>";
                                    Total[cont] += febrero[cont];

                                    cont++;

                                }
                                body += "</tr>";
                                break;
                            case 3:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + marzo[cont] + " </td>";
                                    Total[cont] += marzo[cont];
                                    cont++;

                                }
                                body += "</tr>";
                                break;
                            case 4:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + abril[cont] + " </td>";
                                    Total[cont] += abril[cont];
                                    cont++;

                                }
                                body += "</tr>";
                                break;
                            case 5:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + mayo[cont] + " </td>";
                                    Total[cont] += mayo[cont];
                                    cont++;

                                }
                                body += "</tr>";
                                break;
                            case 6:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + junio[cont] + " </td>";
                                    Total[cont] += junio[cont];
                                    cont++;

                                }
                                body += "</tr>";
                                break;
                            case 7:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + julio[cont] + " </td>";
                                    Total[cont] += julio[cont];
                                    cont++;

                                }
                                body += "</tr>";
                                break;
                            case 8:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + agosto[cont] + " </td>";
                                    Total[cont] += agosto[cont];
                                    cont++;

                                }
                                body += "</tr>";
                                break;
                            case 9:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + setiembre[cont] + " </td>";
                                    Total[cont] += setiembre[cont];
                                    cont++;

                                }
                                body += "</tr>";
                                break;
                            case 10:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + octubre[cont] + " </td>";
                                    Total[cont] += octubre[cont];
                                    cont++;

                                }
                                body += "</tr>";
                                break;
                            case 11:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + noviembre[cont] + " </td>";
                                    Total[cont] += noviembre[cont];
                                    cont++;

                                }
                                body += "</tr>";
                                break;
                            case 12:
                                body += "<tr><td>" + retornarMES(j) + "</td>";
                                var cont = 0;
                                for (var h = anio2; h <= anio1; h++) {
                                    body += "<td>" + diciembre[cont] + " </td>";
                                    Total[cont] += diciembre[cont];
                                    cont++;

                                }
                                body += "</tr>";
                                break;
                            default:
                                break;
                        }//end switch j
                    }//end for j

                    body += "<tr><th>Total: </th>";
                    var cont = 0;
                    for (var h = anio2; h <= anio1; h++) {
                        body += "<td>" + Total[cont] + " </td>";
                        cont++;
                    }
                    body += "</tr>";
                    var f = new Date();
                    document.getElementById('Codigo').style.display = "";
                    document.getElementById('Version').style.display = "";
                    document.getElementById('FechaRegir').style.display = "";
                    var headBody =  "<tr><th>Código:</th><th>Versión:</th><th>Rige a partir:</th><th>Planta:</th><th>Fecha:</th></tr>"
                    var head = "<tr><td>" + document.getElementById("Codigo").value + "</td><td>" + document.getElementById("Version").value + "</td><td>" + document.getElementById("FechaRegir").value +
                    "</td><td>" + selected + "</td><td>" + f.getDate() + "/" + (f.getMonth() + 1) + "/" + f.getFullYear() + "</td></tr>";
                    $("#HistoricosBody").html(body);
                    $("#EncabezadoBody").html(headBody);
                    $("#BodyEncabezado").html(head);
                    $("#EncabezadoHistoricosBody").html(headHistoricosBody);


                }//sucess
            });
        }
    }//end function

    var Mes;
    function retornarMES(mes){
        switch(mes){
            case 1:
                return "Enero";
            case 2:
                return "Febrero";
            case 3:
                return "Marzo";
            case 4:
                return "Abril";
            case 5:
                return "Mayo";
            case 6:
                return "Junio";
            case 7:
                return "Julio";
            case 8:
                return "Agosto";
            case 9:
                return "Setiembre";
            case 10:
                return "Octubre";
            case 11:
                return "Noviembre";
            case 12:
                return "Diciembre";
            default:
                return "Enero";
        }//end switc
    }//end funcuion
    function sumarCantidad(mes, cantidadM3) {
        switch (mes) {
            case 1:
                return "Enero";
            case 2:
                return "Febrero";
            case 3:
                return "Marzo";
            case 4:
                return "Abril";
            case 5:
                return "Mayo";
            case 6:
                return "Junio";
            case 7:
                return "Julio";
            case 8:
                return "Agosto";
            case 9:
                return "Setiembre";
            case 10:
                return "Octubre";
            case 11:
                return "Noviembre";
            case 12:
                return "Diciembre";
            default:
                return "Enero";
        }//end switc
    }//end funcuion



    function exportarPDF() {
        document.getElementById('pdf').style.display = "block";
        var pdf = new jsPDF('p', 'pt', 'letter');
        source = $('#pdf')[0];

        specialElementHandlers = {
            '#bypassme': function (element, renderer) {
                return true
            }
        };
        margins = {
            top: 50,
            bottom: 50,
            left: 72,
            width: 600
        };

        pdf.fromHTML(
          source,
          margins.left,
          margins.top, {
              'width': margins.width,
              'elementHandlers': specialElementHandlers
          });
        var combo = document.getElementById("plantas");
        var selected = combo.options[combo.selectedIndex].text;
        var f = new Date();
        pdf.save(selected+"Reporte"+ f.getDay()+"/"+f.getMonth()+"/"+f.getYear() +".pdf");

    }//pdf

</script>


